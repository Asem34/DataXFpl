<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataXFPL - Predicted Points</title>
    <!-- Include Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom class for the active tab (Lime Accent: #aeff00) */
        .tab-active {
            border-bottom-color: #aeff00; 
            color: #aeff00; 
        }
        /* Custom scrollbar for better look in dark mode */
        .player-list::-webkit-scrollbar {
            width: 8px;
        }
        /* Background Color (Black but slightly blue: #10141f) */
        .player-list::-webkit-scrollbar-track {
            background: #10141f; 
        }
        .player-list::-webkit-scrollbar-thumb {
            background: #4b5563; /* Gray-600 */
            border-radius: 4px;
        }
        /* Accent color on hover (Lime Accent: #aeff00) */
        .player-list::-webkit-scrollbar-thumb:hover {
            background: #aeff00; 
        }
    </style>
</head>
<!-- Applying custom background color #10141f (Black, slightly blue) -->
<body class="bg-[#10141f] text-gray-100 min-h-screen p-4 sm:p-8">

    <div class="container max-w-6xl mx-auto">
        
        <header class="text-center mb-8">
            <!-- Applying custom accent color #aeff00 to the title -->
            <h1 class="text-3xl sm:text-4xl font-bold text-[#aeff00]">Predicted Points Dashboard</h1>
            <p class="text-gray-400 mt-2">Analyze player performance and clean sheet probabilities.</p>
        </header>

        <!-- Search and Filter Controls -->
        <!-- Keeping this as bg-gray-800 to ensure contrast against the new background -->
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
            
            <!-- Search Input -->
            <div class="mb-4">
                <input type="text" id="search-input" placeholder="Search by player or team name..."
                       class="w-full p-3 rounded-lg bg-gray-700 text-gray-100 border border-gray-600 
                       <!-- Applying custom accent color for focus state -->
                       focus:border-[#aeff00] focus:ring focus:ring-[#aeff00] focus:ring-opacity-50 transition duration-150">
            </div>

            <!-- Position Filters (Uses the .tab-active style) -->
            <div id="filter-tabs" class="flex justify-center border-b border-gray-700 space-x-2 sm:space-x-4">
                <button class="tab-item border-b-2 px-4 py-2 text-sm font-medium transition-colors tab-active" data-filter="All">All</button>
                <button class="tab-item border-b-2 border-transparent px-4 py-2 text-sm font-medium hover:border-gray-500 transition-colors" data-filter="FWD">FWD</button>
                <button class="tab-item border-b-2 border-transparent px-4 py-2 text-sm font-medium hover:border-gray-500 transition-colors" data-filter="MID">MID</button>
                <button class="tab-item border-b-2 border-transparent px-4 py-2 text-sm font-medium hover:border-gray-500 transition-colors" data-filter="DEF">DEF</button>
                <button class="tab-item border-b-2 border-transparent px-4 py-2 text-sm font-medium hover:border-gray-500 transition-colors" data-filter="GK">GK</button>
            </div>

        </div>

        <!-- Results Container -->
        <div id="results-container" class="player-list grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[70vh] overflow-y-auto">
            <!-- Player cards will be injected here -->
            <div class="text-center text-gray-400 p-8" id="loading-message">Loading player data...</div>
        </div>
        
    </div>

    <script type="module">
        // Global state
        let allPlayers = [];
        let currentFilter = 'All';
        let currentSearch = '';

        // DOM Elements
        const resultsContainerEl = document.getElementById('results-container');
        const searchInputEl = document.getElementById('search-input');
        const filterTabs = document.querySelectorAll('.tab-item');
        const loadingMessageEl = document.getElementById('loading-message');

        /**
         * 1. Fetch and Parse CSV Data
         * Fetches the predicted_points.csv file and parses it into a usable array of player objects.
         */
        async function fetchAndParseData() {
            // Using the filename as the path to fetch the CSV
            const csvFilePath = 'predicted_points.csv'; 
            
            try {
                const response = await fetch(csvFilePath);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                
                // Simple CSV parsing: split by line, then by comma
                const lines = csvText.trim().split('\n');
                if (lines.length < 2) {
                    loadingMessageEl.textContent = 'No data found in CSV file.';
                    return;
                }

                const headers = lines[0].split(',');
                allPlayers = lines.slice(1).map(line => {
                    const values = line.split(',');
                    const player = {};
                    headers.forEach((header, i) => {
                        // Clean up headers and convert numeric fields
                        const key = header.trim();
                        let value = values[i].trim();

                        if (['goals', 'assists', 'Def_Con_Per_90', 'Def_Con_Bonus', 'Team_Clean_Sheet_Prob', 'Predicted_Points'].includes(key)) {
                            // Convert string to float, handle potential NaN with 0
                            value = parseFloat(value) || 0.0;
                        }
                        
                        // Map long names to shorter, cleaner keys for display
                        if (key === 'full_name') player.name = value;
                        else if (key === 'Team_Name') player.team = value;
                        else if (key === 'position') player.position = value;
                        else if (key === 'vs') player.opponent = value;
                        else if (key === 'Team_Clean_Sheet_Prob') player.csProb = value;
                        else if (key === 'Predicted_Points') player.predictedPoints = value;
                        else {
                            player[key] = value;
                        }
                    });
                    return player;
                });

                loadingMessageEl.classList.add('hidden');
                renderPlayers();

            } catch (error) {
                console.error('Error fetching or parsing CSV:', error);
                loadingMessageEl.textContent = 'Failed to load data. Please check the console for details.';
            }
        }

        /**
         * 2. Main Rendering Logic
         * Filters, sorts, and displays the player cards.
         */
        function renderPlayers() {
            // 1. Filtering
            const searchLower = currentSearch.toLowerCase();
            const filteredPlayers = allPlayers
                .filter(player => {
                    // Filter by position (GK is now included)
                    if (currentFilter !== 'All' && player.position !== currentFilter) {
                        return false;
                    }
                    // Filter by search term (name or team)
                    return player.name.toLowerCase().includes(searchLower) || 
                           player.team.toLowerCase().includes(searchLower);
                });

            // 2. Sorting (by Predicted_Points descending)
            const sortedPlayers = filteredPlayers.sort((a, b) => b.predictedPoints - a.predictedPoints);

            // 3. Render
            resultsContainerEl.innerHTML = '';
            
            if (sortedPlayers.length === 0) {
                resultsContainerEl.innerHTML = `<div class="col-span-full text-center text-gray-500 p-8">No players match the current filters or search term.</div>`;
                return;
            }

            sortedPlayers.forEach(player => {
                const card = createPlayerCard(player);
                resultsContainerEl.appendChild(card);
            });
        }

        /**
         * 3. Create Player Card Element
         * Creates an HTML div element for a single player's data.
         */
        function createPlayerCard(player) {
            const card = document.createElement('div');
            
            // Determine background color based on position for quick identification
            let bgColorClass = 'bg-gray-800';
            if (player.position === 'FWD') bgColorClass = 'bg-red-900/40';
            else if (player.position === 'MID') bgColorClass = 'bg-green-900/40';
            else if (player.position === 'DEF') bgColorClass = 'bg-blue-900/40';
            else if (player.position === 'GK') bgColorClass = 'bg-purple-900/40';

            // Apply custom accent color #aeff00 to the left border
            card.className = `p-4 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-[1.01] border-l-4 border-[#aeff00] ${bgColorClass}`;
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <h2 class="text-xl font-bold text-gray-50">${player.name}</h2>
                        <p class="text-sm text-gray-400">
                            <span class="font-semibold text-gray-300">${player.team}</span> 
                            <span class="ml-1 text-gray-500">vs ${player.opponent}</span>
                        </p>
                    </div>
                    <div class="text-right">
                        <!-- Apply custom accent color #aeff00 to Predicted Points -->
                        <p class="text-2xl font-extrabold text-[#aeff00]">${player.predictedPoints.toFixed(2)}</p>
                        <p class="text-xs uppercase text-gray-400 -mt-1">Pts</p>
                    </div>
                </div>

                <div class="grid grid-cols-5 gap-2 text-center border-t border-gray-700 pt-3 mt-3">
                    <div>
                        <p class="text-gray-400 text-xs uppercase">Position</p>
                        <p class="font-medium text-lg">${player.position}</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs uppercase">Goals</p>
                        <p class="font-medium">${player.goals.toFixed(2)}</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs uppercase">Assists</p>
                        <p class="font-medium">${player.assists.toFixed(2)}</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs uppercase">Def. Cons.</p>
                        <p class="font-medium">${player.Def_Con_Per_90.toFixed(2)}</p>
                    </div>
                     <div>
                        <p class="text-gray-400 text-xs uppercase">CS Prob.</p>
                        <!-- Apply custom accent color #aeff00 to Clean Sheet Probability -->
                        <p class="font-medium text-[#aeff00]">${(player.csProb * 100).toFixed(1)}%</p>
                    </div>
                </div>
            `;
            return card;
        }

        /**
         * 4. Set up Event Listeners
         */
        
        // Search input
        searchInputEl.addEventListener('input', (e) => {
            currentSearch = e.target.value;
            // Debounce rendering slightly for smoother typing
            setTimeout(renderPlayers, 100);
        });

        // Filter tabs
        filterTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Update active class on tabs
                filterTabs.forEach(t => t.classList.remove('tab-active'));
                tab.classList.add('tab-active');
                
                // Update state and re-render
                currentFilter = tab.dataset.filter;
                renderPlayers();
            });
        });

        // Initial load is triggered here
        fetchAndParseData();

    </script>
</body>

</html>
